<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Decision Bot</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        button, input { margin: 10px 0; padding: 5px; }
        #result { font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Restaurant Decision Bot</h1>
    <div id="home">
        <button onclick="createRoom()">Create New Room</button>
        <br>
        <input id="joinRoomCode" placeholder="Enter room code">
        <button onclick="joinRoom()">Join Room</button>
    </div>
    <div id="room" style="display:none;">
        <h2>Room: <span id="roomCode"></span></h2>
        <div id="userInput">
            <input id="username" placeholder="Enter your name">
            <button onclick="addUser()">Join</button>
        </div>
        <div id="waiting" style="display:none;">
            <p>Waiting for others to join...</p>
            <button onclick="setReady()">I'm Ready</button>
        </div>
        <div id="questions" style="display:none;">
            <p id="currentQuestion"></p>
            <input id="answer" placeholder="Your answer">
            <button onclick="submitAnswer()">Submit</button>
        </div>
        <div id="result"></div>
    </div>

    <script>
        // Your Firebase configuration object goes here
        const firebaseConfig = {
  apiKey: "AIzaSyC2Kd6hXhNxE6LRwVHRwLqrxqpsPCfycBI",
  authDomain: "letseat-5bf12.firebaseapp.com",
  projectId: "letseat-5bf12",
  storageBucket: "letseat-5bf12.appspot.com",
  messagingSenderId: "229303761359",
  appId: "1:229303761359:web:cf88c9ffeb6ac3481bfaba",
  measurementId: "G-WY7SCHEK82"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let roomId = '';
        let currentUser = '';
        let currentQuestion = 0;

        const questions = [
            "What type of cuisine do you prefer?",
            "How far are you willing to travel? (in minutes)",
            "What's your budget per person? (in $)",
            "Any dietary restrictions?",
            "Preferred ambiance? (casual, formal, etc.)",
            "How much time do you have for the meal? (in minutes)",
            "Any specific cravings?"
        ];

        function createRoom() {
            roomId = Math.random().toString(36).substring(2, 8).toUpperCase();
            database.ref('rooms/' + roomId).set({
                users: {},
                readyUsers: {},
                answers: {},
                showQuestions: false
            });
            document.getElementById('home').style.display = 'none';
            document.getElementById('room').style.display = 'block';
            document.getElementById('roomCode').textContent = roomId;
            listenToRoomChanges();
        }

        function joinRoom() {
            roomId = document.getElementById('joinRoomCode').value.toUpperCase();
            document.getElementById('home').style.display = 'none';
            document.getElementById('room').style.display = 'block';
            document.getElementById('roomCode').textContent = roomId;
            listenToRoomChanges();
        }

        function listenToRoomChanges() {
            database.ref('rooms/' + roomId).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data && data.showQuestions) {
                    document.getElementById('waiting').style.display = 'none';
                    document.getElementById('questions').style.display = 'block';
                    document.getElementById('currentQuestion').textContent = questions[currentQuestion];
                }
                if (data && data.result) {
                    document.getElementById('questions').style.display = 'none';
                    document.getElementById('result').textContent = data.result;
                }
            });
        }

        function addUser() {
            currentUser = document.getElementById('username').value;
            if (currentUser) {
                database.ref('rooms/' + roomId + '/users/' + currentUser).set(true);
                document.getElementById('userInput').style.display = 'none';
                document.getElementById('waiting').style.display = 'block';
            }
        }

        function setReady() {
            database.ref('rooms/' + roomId + '/readyUsers/' + currentUser).set(true);
            database.ref('rooms/' + roomId).once('value', (snapshot) => {
                const data = snapshot.val();
                if (Object.keys(data.readyUsers).length === Object.keys(data.users).length) {
                    database.ref('rooms/' + roomId + '/showQuestions').set(true);
                }
            });
        }

        function submitAnswer() {
            const answer = document.getElementById('answer').value;
            database.ref('rooms/' + roomId + '/answers/' + currentUser + '/' + currentQuestion).set(answer);
            currentQuestion++;
            if (currentQuestion < questions.length) {
                document.getElementById('currentQuestion').textContent = questions[currentQuestion];
                document.getElementById('answer').value = '';
            } else {
                checkAllAnswered();
            }
        }

        function checkAllAnswered() {
            database.ref('rooms/' + roomId).once('value', (snapshot) => {
                const data = snapshot.val();
                if (Object.keys(data.answers).length === Object.keys(data.users).length) {
                    decideRestaurant(data.answers);
                }
            });
        }

        function decideRestaurant(answers) {
            const cuisines = Object.values(answers).map(a => a[0]);
            const mostCommonCuisine = cuisines.sort((a,b) =>
                cuisines.filter(v => v === a).length - cuisines.filter(v => v === b).length
            ).pop();
            
            const avgBudget = Object.values(answers).reduce((sum, a) => sum + parseInt(a[2]), 0) / Object.keys(answers).length;
            const avgTime = Object.values(answers).reduce((sum, a) => sum + parseInt(a[5]), 0) / Object.keys(answers).length;

            const result = `Based on your answers, we recommend a ${mostCommonCuisine} restaurant with an average budget of $${avgBudget.toFixed(2)} per person. You have about ${avgTime.toFixed(0)} minutes for your meal.`;
            database.ref('rooms/' + roomId + '/result').set(result);
        }
    </script>
</body>
</html>
